option(ZIPLIB_BUNDLED_BZIP2 "Use bundled bzip2" ON)

if (ZIPLIB_BUNDLED_BZIP2)
    message(STATUS "ZipLib: Using bundled bzip2, use option ZIPLIB_BUNDLED_BZIP2")
    cmake_policy(PUSH)
    cmake_policy(SET CMP0077 NEW) # option() honors normal variables.
    set(ENABLE_LIB_ONLY ON)
    set(ENABLE_STATIC_LIB ON)
    add_subdirectory(bzip2-master)
    cmake_policy(POP)
    add_library(ziplib::external_bzip2 ALIAS bz2_static)
elseif (TARGET bz2_static)
    add_library(ziplib::external_bzip2 ALIAS bz2_static)
elseif (TARGET bz2)
    add_library(ziplib::external_bzip2 ALIAS bz2)
else ()
    find_package(BZIP2 REQUIRED)
    add_library(ziplib::external_bzip2 ALIAS BZip2::BZip2)
endif ()
